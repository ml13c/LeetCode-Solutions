class Solution {
public:
    int numSubmat(vector<vector<int>>& mat) {
        int rows = mat.size(), cols = mat[0].size();
        vector<vector<int>> width(rows, vector<int>(cols, 0));

        for (int r = 0; r < rows; r++) {
            for (int c = 0; c < cols; c++) {
                if (mat[r][c] == 1) {
                    width[r][c] = (c == 0 ? 1 : width[r][c - 1] + 1);
                }
            }
        }

        int total = 0;
        for (int r = 0; r < rows; r++) {
            for (int c = 0; c < cols; c++) {
                int minWidth = INT_MAX;
                for (int k = r; k >= 0 && minWidth > 0; k--) {
                    minWidth = min(minWidth, width[k][c]);
                    total += minWidth;
                }
            }
        }
        return total;
    }
};
